# 1.绪论

## 1.1 网络、互连网（互联网）和因特网

- 网络：网络由若干节点和连接这些节点的链路组成。
  - 多台计算机通过一台交换机互连起来形成一个网络，这多台计算机和这一台交换机都称为节点，计算机和交换机之间连接的线路称为链路。
- 互联网：多个网络还可以通过路由器互连起来，这样就构成了一个覆盖范围更大的网络，即互联网（或互连网）。
- 因特网：因特网是世界上最大的互连网络（用户数以亿计，互连的网络数以百万计）；

## 1.2 因特网的组成

- 边缘部分：由所有连接在因特网上的主机组成。这部分是用户直接使用的，用来进行通信（传送数据、音频或视频）和资源共享。

- 核心部分：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供连通性和交换）。

  <img src="assets/image-20240605151450293.png" alt="image-20240605151450293" style="zoom:33%;" />

## 1.3 三种交换技术

### 1.3.1 电路交换（用于电话网络）

- 通过物理线路的连接，动态的分配线路传输资源。
- 电路交换的过程
  - 建立连接（尝试占用通信资源）
  - 通信（一直占用通信资源）
  - 释放连接（归还通信资源）
- 电路交换的优缺点
  - 优点
    - 通信前从主叫端到被叫端建立一条专用的物理通路，在通信的全部时间内，两个用户始终占用端到端的线路资源。数据直送，传输速率高。
    - 电路交换更适用于：低频次，大量地数据传输。
  - 缺点
    - 建立/释放连接，需要额外的时间开销
    - 线路被通信双方独占，利用率低
    - 线路分配的灵活性差
    - 计算机之间数据往往是“突发式”传输，即往往会高频次、少量地传输数据。

### 1.3.2 报文交换（用于电报网络）

- 一份报文（电报）包含两部分信息
  - 控制信息：发送方地址、接收方地址
  - 用户所有数据

- 报文交换的优缺点
  - 优点
    - 通信前无需建立连接
    - 数据以“报文”为单位被交换节点之间“存储转发”，通信线路可以灵活分配
      - 存储转发的思想：把传送的数据单元先存储进中间节点，再根据目的地址转发至下一节点。
    - 在通信时间内，两个用户无需独占一整条物理线路，相比于电路交换，线路利用率高。
    - 交换节点支持“差错控制”（通过校验技术）
  - 缺点
    - 报文不定长，不方便存储转发管理
    - 长报文的存储转发时间开销大、缓存开销大
    - 长报文容易出错，重传代价高

### 1.3.3 分组交换（用于现代计算机网络）

- 把一份报文拆成多个大小相同的小报文，这些小报文被称为分组，每个分组也包含两部分的信息
  - 控制信息：发送方地址、接收方地址
  - 用户部分数据

- 分组交换的优缺点
  - 优点
    - 通信前无需建立连接
    - 数据以“分组”为单位被交换节点之间“存储转发”，通信线路可以灵活分配
      - 存储转发的思想：把传送的数据单元先存储进中间节点，再根据目的地址转发至下一节点。
    - 在通信时间内，两个用户无需独占一整条物理线路，相比于电路交换，线路利用率高。
    - 交换节点支持“差错控制”（通过校验技术）
    - 相比于报文交换，分组交换改进了如下问题
      - 分组定长，方便存储转发管理
      - 分组的存储转发时间开销小，缓存开销小
      - 分组不易出错，重传代价低
  - 缺点
    - 相比于报文交换，控制信息占比增加（每个分组都携带了一份控制信息）
    - 相比于电路交换，依然存在存储转发时延
    - 报文被拆分为多个分组，传输过程中可能出现失序、丢失等问题，增加处理的复杂度。

## 1.4 计算机网络的定义和分类

### 1.4.1 计算机网络的定义

- 最简单的定义：一些互连的、自治的计算机的集合；
  - 自治表示每台计算机都是独立的，它们有各自的软硬件
- 较好的定义：计算机网络主要是由一些通用的、可编程的硬件互连而成的，这些硬件硬件并非专门用来实现某一特定目的（例如，传送数据或视频信号）。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。

### 1.4.2 计算机网络的分类

- 按交换技术分类
  - 电路交换网
  - 报文交换网
  - 分组交换网
- 按使用者分类
  - 公用网（普通用户接入的电信网）
  - 专用网（如军队、银行使用的网络）
- 按传输介质分类
  - 有线网络
  - 无线网络
- 按覆盖范围分类
  - 广域网（WAN）
  - 城域网（MAN）
  - 局域网（LAN）
  - 个域网（PAN）
- 按拓扑结构分类
  - 总线型网络
  - 星型网络
  - 环型网络
  - 网状网络

## 1.5 计算机网络的性能指标

- 速率
  - 连接在计算机网络上的主机在数字信道上传输比特的速率，也称为比特率或数据率。
  - 基本单位：bit/s (b/s、bps)，常用单位：kb/s，Mb/s, Gb/s，Tb/s
- 带宽
  - 用来表示网络的通信线路所能传送数据的能力，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”；单位与速率单位相同。
- 吞吐量
  - 吞吐量表示在单位时间内通过某个网络（或信道、接口）的数据量；
  - 吞吐量被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络；吞吐量受网络的带宽或额定速率的限制。
- 时延
  - 发送时延
  - 传播时延
  - 处理时延

## 1.6 计算机网络体系结构

- 常见的三种计算机网络体系结构

  - 开放系统互联参考模型（OSI）
    - 为了使得不同体系结构的计算机网络都能互连起来，国际标准化组织（ISO）提出了开放系统互连参考模型；
    - OSI刚被提出来时，采用TCP/IP体系结构的因特网已经抢先在全世界覆盖了相当大的范围。
    - 因此，OSI只停留在了理论方面，OSI在市场化方面输给了TCP/IP。

  - TCP/IP体系结构
    - 由于TCP/IP体系结构中包含大量的协议，而IP协议和TCP协议是其中最重要的两个协议，因此用TCP和IP这两个协议来表示整个协议大家族，常称为TCP/IP协议族。

  - 五层原理体系结构
    - TCP/IP体系结构为了将不同的网络接口进行互连，其网络接口层并没有规定什么具体内容，因此如果直接学习TCP/IP体系结构的话，可能物理层和数据链路层的学习我们就给忽略了，这对于我们学习计算机网络的完整体系结构来说就会缺少一部分内容。因此在学习计算机网络原理是往往采取折中的办法，也就是综合OSI参考模型和TCP/IP参考模型，采用一种原理参考模型。

- 计算机网络体系结构分层的必要性

  - 为什么要分层?
    - “分层”可以将庞大而复杂的问题转化为若干较小的局部问题，而这些较小的局部问题就比较容易研究和处理。

  - 物理层解决什么问题？
    - 主机A和主机B要想互连进行数据传输
      - 应该要采用什么传输介质？
      - 这根传输介质两端规定采用什么接口分别和主机A和主机B相连？
      - 这根传输介质中的数据应该采用什么信号进行传输？
  - 数据链路层解决什么问题？
    - 主机A、主机B和主机C通过一根总线互连进行数据传输
      - 如何识别网络中的每一台主机？MAC地址
      - 如何区分出地址和数据？通信的双方事先规定好数据包的格式
      - 各主机进行数据传输时，如何协调各主机竞争使用总线？

# 2.物理层

## 2.1 物理层要实现的功能

- 物理层要实现的功能是在各种传输媒体上传输比特0和1，进而给上面的数据链路层提供透明传输比特流的服务。
- 透明传输比特流的意思是数据链路层“看不见”（也无须看见）物理层究竟使用的是什么方法来传输比特流，数据链路层只管“享受”物理层提供的比特流传输服务即可。

## 2.2 物理层下面的传输媒体

- 有线传输媒体
  - 同轴电缆
  - 双绞线
  - 光纤
- 无线传输媒体
  - 无线电波
  - 微波
  - 红外线
  - 激光
  - 可见光

## 2.3 数字传输方式

### 2.3.1 串行传输和并行传输

- 串行传输：发送端和接收端之间只有一条数据传输线路，构成数据的多个比特在这条数据传输线路上逐比特依次传输。

  <img src="assets/image-20240621152657806.png" alt="image-20240621152657806" style="zoom:33%;" />

- 并行传输：在发送端和接收端之间有多条数据传输线路，构成数据的多个比特被分别安排在不同的数据传输线路上同时传输。

  <img src="assets/image-20240621152710935.png" alt="image-20240621152710935" style="zoom:33%;" />

### 2.3.2 单向通信、双向交替通信和双向同时通信

- 单向通信

  <img src="assets/image-20240621155341570.png" alt="image-20240621155341570" style="zoom:33%;" />

- 双向交替通信

  <img src="assets/image-20240621155314646.png" alt="image-20240621155314646" style="zoom:33%;" />

- 双向同时通信

  <img src="assets/image-20240621155414832.png" alt="image-20240621155414832" style="zoom:33%;" />

## 2.4 编码与调制

![image-20240621160002572](assets/image-20240621160002572.png)

- 消息、数据和信号
  - 在计算机网络中，需要由计算机处理和传输的文字、图片、音频和视频等内容，可以统称为消息。
  - 消息输入计算机后，就成为了有意义的二进制符号序列，即数据（比特0和比特1构成的数字序列）。
  - 计算机中的网卡将比特0和比特1变换成相应的信号发送到传输媒体。

- 基带信号
  - 由计算机输出的表示各种文字、图像、音频或视频文件的数字信号都属于基带信号。
  - 基带信号往往包含较多的低频成分，甚至包含（由连续个“0”或连续个“1”造成的）直流成分，而许多信道不能传输这种低频分量或直流分量，在通过不能传输这些成分的信道时，这些部分就传不过去，导致信号失真或丢失。因此需要对基带信号进行调制后才能在不能传输这些成分的信道上传输。

- 调制
  - 基带调制
    - 对数字基带信号的波形进行变换，使其能够与信道特性相适应，调制后的信号仍然是数字基带信号。
    - 由于基带调制是把数字信号转换成另一种形式的数字信号，因此基带调制也称为编码。
  - 带通调制
    - 将数字基带信号的频率范围搬移到较高的频段，并转换成模拟信号，使其能够在模拟信道中传输。

# 3.数据链路层

## 3.1 数据链路层的三个重要问题

### 3.1.1 封装成帧和透明传输

- 封装成帧
  - 就是给网络层交付下来的分组添加一个首部和一个尾部，这样就构成了一个帧。
  - 帧的首部和尾部中包含有一些重要的控制信息。例如，帧首部中往往包含帧开始符、帧的源地址和目的地址，而帧尾部中往往包含帧校验序列和帧结束符。
  - 接收方的数据链路层在收到物理层交付上来的比特流后，根据帧首部中的帧开始符和帧尾部中的帧结束符，从收到的比特流中识别出帧的开始和结束，也就是进行帧定界。
- 透明传输
  - 如果在帧的数据载荷部分恰好也出现了帧定界符（帧开始符或帧结束符），就会造成接收方数据链路层出现帧定界的错误。
  - 如果不解决上述问题，则数据链路层就会对上层交付的协议数据单元（PDU）的内容有所限制，即PDU中不能包含帧定界符。
  - 如果能够采取措施，使得数据链路层对上层交付的PDU的内容没有任何限制，就好像数据链路层不存在一样，就称其为透明传输。
  - 实现透明传输的方法有两种：字节填充和比特填充。

### 3.1.2 差错检测

实际的通信链路都是不理想的。表示比特的信号在信道上传输时，不可避免地会产生失真，甚至出现更严重的错误。这就会导致比特在传输过程中产生差错：比特1可能会变成比特0，而比特0也可能变成比特1。这种传输差错称为比特差错。常用的检错技术有：奇偶校验和循环冗余校验。

- 奇偶校验

  - 奇校验是在待发送的数据后面添加1个校验位，使得添加该校验位后的整个数据中比特1的个数为奇数。

  - 偶校验是在待发送的数据后面添加1个校验位，使得添加该校验位后的整个数据中比特1的个数为偶数。

    ![image-20240622165713445](assets/image-20240622165713445.png)

    ![image-20240622165818585](assets/image-20240622165818585.png)

  - 在所传输的数据中，如果有奇数个位发生误码，则所包含比特1 的数量的奇偶性会发生改变，可以检测出误码。

  - 在所传输的数据中，如果有偶数个位发生误码，则所包含比特1 的数量的奇偶性不会发生改变，无法检测出误码（漏检）。

- 循环冗余码校验

  - 收发双方约定好一个生成多项式G(X) 。

  - 发送方基于待发送的数据和生成多项式G(X)，计算出差错检测码（冗余码），将冗余码添加到待发送数据的后面一起传输。

  - 接收方收到数据和冗余码后，通过生成多项式G(X) 来计算收到的数据和冗余码是否产生了误码。

    <img src="assets/image-20240622171126181.png" alt="image-20240622171126181" style="zoom:33%;" />

    ​													

    ​												<img src="assets/image-20240622172014521.png" alt="image-20240622172014521" style="zoom:33%;" />

### 3.1.3 可靠传输

- 可靠传输的相关基本概念

  - 使用差错检测技术（例如循环冗余码校验），接收方的数据链路层就可检测出帧再传输过程中是否产生了误码（比特错误）。如果检测出了误码：
    - 若数据链路层向其上层提供的是不可靠的传输服务，则接收方的数据链路层丢弃有误码的帧即可；
    - 若数据链路层向其上层提供的是可靠的传输服务，这就需要数据链路层通过某种机制实现发送方发送什么，接受方就能收到什么。有线链路误码率低，一般不要求数据链路层向其上层提供可靠传输服务，而无线链路误码率高，一般要求数据链路层为其上层提供可靠传输服务。三种实现可靠传输的机制分别是：停止-等待协议、回退N帧协议、选择重传协议。

- 停止等待协议

  - 基本原理：所谓停止-等待协议，就是指发送方每发送完一个数据分组就必须停下来，等待接收方发来的确认分组或否认分组。

    - 最简单的情况的策略

      <img src="assets/image-20240623153916891.png" alt="image-20240623153916891" style="zoom:33%;" />

      - 缺陷：如果数据分组丢失，发送方将无法受到确认分组，更别提否认分组了。

    - 数据分组丢失的情况的处理策略

      <img src="assets/image-20240623154228249.png" alt="image-20240623154228249" style="zoom:33%;" />

      - 缺陷：如果接收方发过来的确认分组在中途丢失，发送方则一直收不到确认分组，因此发送方必将重传之前的分组，此时接收方必然受到了与之前相同的分组，此时就产生了分组重复的传输差错。

    - 确认分组丢失的情况的处理策略

      <img src="assets/image-20240623154856098.png" alt="image-20240623154856098" style="zoom:33%;" />

      - 为了防止发送方收到重复的确认分组，确认分组也需要编号

        <img src="assets/image-20240623155901535.png" alt="image-20240623155901535" style="zoom:33%;" />

  - 停止等待协议缺点：

    - 当数据分组发送时延 < 往返时间时，信道利用率很低。

    - 因此对于数据分组发送时延较小，但往返时间很大（例如卫星链路）的应用，不适用于使用停止-等待协议来实现可靠传输。

    - 对于数据分组发送时延较小，但往返时间很大的情况下，收发双方可以不采用信道利用率很低的停止等待协议，可以采用使用流水线传输方式的 “回退N帧协议”。

      - 所谓流水线传输就是指发送方在未收到接收方发来确认分组的情况下，可以连续发送多个数据分组，而不必每发送完一个数据分组就停下来等待接收方的确认分组。这种传输方式可以明显提高信道利用率。

        <img src="assets/image-20240624160656665.png" alt="image-20240624160656665" style="zoom:33%;" />

- 回退N帧协议

  - 回退N帧协议采用流水线传输方式，并且利用发送窗口来限制发送方连续发送数据分组的数量。

  - 发送窗口和接受窗口的理解

    - 发送方需要维护一个发送窗口，在未收到接受方确认分组的情况下，发送方可将序号落入发送窗口内的所有数据分组连续发送出去。

    - 接收方需要维护一个接受窗口，只有正确到达接收方且序号落入接受窗口内的数据分组才被接受方接受。

      <img src="assets/image-20240624171437731.png" alt="image-20240624171437731" style="zoom:33%;" />

    - 发送窗口和接受窗口的滑动情况如下：
      - 接收方每正确收到一个序号落入接受窗口的数据分组，就将接收窗口向前滑动一个位置，这样就有一个新的序号落入接受窗口。与此同时，接收方还要给发送方发送针对该数据分组的确认分组。
      - 发送方每收到一个按序确认的确认分组，就将发送窗口向前滑动一个位置，这样就有一个新的序号落入发送窗口，序号落入发送窗口内的数据分组可继续被发送。

  - 回退N帧协议的工作过程
    - 无传输差错的情况
    - 有传输差错、超时重传、回退N帧的情况 
    - 累计确认的情况

  - 缺陷：
    - 回退N帧协议在无数据分组差错的情况下，其信道利用率比停止-等待协议要高不少。但是，一个数据分组的差错就可能引起大量数据分组的重传，而这些重传的数据分组原本已经正确到达接收方，但是由于序号未落入接收窗口内而被接收方丢弃。显然，这些数据分组的重传是对通信资源的严重浪费。
    - 为了进一步提高信道利用率，可以设法只重传出现差错的数据分组，这就需要接收窗口的尺寸大于1，以便先收下失序但正确到达接收方且序号落入接受窗口内的数据分组，等到所缺数据分组收齐后，在一并送交上层，这就是选择重传协议。

- 选择重传协议
  - 为了使发送方仅重传出现差错的数据分组，接收方不能再采用累积确认，而需要对每一个正确接收的数据分组进行逐一确认。接收方需要有足够的缓存空间，来暂存失序但正确到达接收方且序号落入接收窗口内的数据分组。
  - 一般情况下，在选择重传协议中，发送窗口和接收窗口是相同的。

## 3.2 点对点协议（PPP协议）

- PPP协议就采用了上面三个重要问题的处理策略。

### 3.2.1 PPP协议用在什么地方呢？

- 因特网用户的计算机通过点对点链路连接到某个ISP进而接入因特网，用户计算机与ISP通信是所采用的数据链路层协议一般就是PPP协议。

  <img src="assets/image-20240627190114404.png" alt="image-20240627190114404" style="zoom: 25%;" />

  - 点对点链路：是指在计算机网络和通信系统中，两台设备之间通过物理介质直接连接的一种通信方式。点对点链路的主要特点是只有两个终端设备参与通信，没有其他设备共享这条链路。即两台设备之间有一条独立的物理线路，数据直接从一个设备传输到另一个设备，不经过任何中间设备或节点。

- 广泛应用于广域网路由器之间的专用线路。

  <img src="assets/image-20240627190145092.png" alt="image-20240627190145092" style="zoom:33%;" />

### 3.2.2 PPP协议-封装成帧

- PPP协议帧格式

  <img src="assets/image-20240627191243506.png" alt="image-20240627191243506" style="zoom:33%;" />

### 3.2.3 PPP协议-透明传输

- 字节填充
- 零比特填充

### 3.2.4 PPP协议-差错检测

- 使用循环冗余码校验

### 3.2.5 PPP协议工作过程

- 以用户主机拨号接入因特网服务提供者ISP 的拨号服务器的过程为例：

  <img src="assets/image-20240627191703256.png" alt="image-20240627191703256" style="zoom:33%;" />

## 3.3 共享式以太网

### 3.3.1 什么是以太？

- 以太（ether）这个词最早出现在古希腊哲学中，用来指代一种无形的物质，认为它充满了整个宇宙，是光和电磁波传播的介质。
- 在物理学上，19世纪的科学家也曾假设存在一种“以太”，认为光波在真空中传播需要一种介质。但是后来通过实验（如著名的迈克尔逊-莫雷实验），证明这种假设是错误的。于是，物理学中的“以太”概念被淘汰了。

### 3.3.2 为什么会出现以太网？

- 没有以太网出现时，什么样的问题会出现？
  - 计算机是独立工作的，不能相互通信或共享资源。
  - 要在计算机之间传输数据，需要使用磁带、软盘等物理介质手动传递，这既麻烦又耗时。
  - 各种不同厂商生产的计算机和设备使用不同的通信协议，难以实现互相连接和通信。
  - 当时的网络解决方案速度慢、配置复杂且昂贵，不适合大规模普及。
- 以太网的出现又解决了什么问题？
  - 通过以太网，计算机可以相互连接，组成一个局域网（LAN），使得计算机之间可以方便地通信和共享资源。
  - 以太网提供了高效的数据传输方式，不再需要依赖物理介质传递数据。文件、图片和其他数据可以通过网络快速传输。
  - 以太网采用标准化的通信协议，不同厂商的设备可以轻松互联和通信，增强了设备间的兼容性。
  - 以太网设备相对便宜，安装和维护成本低，使得网络技术能够普及到更多的地方。

### 3.3.2 什么是以太网？

以太网（Ethernet）是一种计算机网络技术，用于在局域网（LAN）中连接设备。以太网是一种有线技术，通过电缆将计算机、打印机、路由器等设备连接在一起，使它们能够相互通信和共享资源。

### 3.3.3 为什么称为以太网？

发明者们借用了“以太”这个概念，来形容一种无处不在的媒介，使网络中的所有设备都能通过这种“无形的媒介”相互通信。

### 3.3.4 网络适配器和MAC地址

- 网络适配器

  - 要将计算机连接到局域网，需要使用相应的网络适配器（Adapter），这些网络适配器一般简称为“网卡”。
  - 网卡构成简述
    - EEPROM：是用来存储MAC地址和网卡相关信息的电可擦写可编程只读存储器。
    - PCI接口：是网卡与计算机主板的接口。
    - RJ45网络接口：就是插网线的那个插口。

  - 网卡的并行传输和串行传输

    <img src="assets/image-20240628212004535.png" alt="image-20240628212004535" style="zoom:33%;" />

    - 在计算机内部，网卡与CPU之间的通信，是通过计算机主板上的I/O总线以并行传输方式进行的。
    - 网卡与外部以太网（局域网）之间的通信，一般是通过传输媒体（同轴电缆、双绞线、光纤）以串行方式进行的。
    - 显然，网卡除了要实现物理层和数据链路层的功能，其另外一个重要功能就是要进行并行传输和串行传输的转换。
    - 由于网络的传输速率和计算机内部总线上的传输速率并不相同，因此在网卡的核心芯片中都会包含用于缓存数据的存储器。

  - 网卡驱动程序

    - 在确保网卡硬件正确的情况下，为了使网卡正常工作，还必须要在计算机操作系统中为网卡安装相应的设备驱动程序。
    - 驱动程序负责驱动网卡发送和接受帧。

- MAC地址

  - MAC地址的作用

    - 对于点对点信道（可以理解为一条链路两台主机），由于只有两个主机分别连接在信道的两端，因此其数据链路层不需要使用地址。

      <img src="assets/image-20240630161517335.png" alt="image-20240630161517335" style="zoom:33%;" />

    - 然而，当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个数据链路层地址。

      <img src="assets/image-20240630161615724.png" alt="image-20240630161615724" style="zoom:33%;" />

    - 在每个主机发送的帧的首部中，都携带有发送主机（源主机）和接收主机（目的主机）的数据链路层地址。由于这类地址是用于媒体接入控制（Medium Access Control，MAC）的，因此被称为MAC地址。

  - IEEE 802局域网的MAC地址

    - IEEE 802标准为局域网规定了一种由48比特构成的MAC地址，从左至右依次为第一字节到第六字节。

    - 前三个字节是组织唯一标识符（OUI），它标识了制造商或组织，也就是说，它告诉你这个网卡是由哪个公司制造的。生产网卡的制造商需要向IEEE的注册管理机构申请一个或多个OUI。

    - 这部分是制造商为特定网卡分配的序列号。它确保在同一制造商生产的所有网卡中，这个序列号都是唯一的。

      <img src="assets/image-20240630163856519.png" alt="image-20240630163856519" style="zoom:33%;" />

### 3.3.5 CSMA/CD协议

- 基本原理

  - 共享总线以太网具有天然的广播特性，即使总线上的某个站点给另一个站点发送单播帧，表示帧的信号也会沿着总线传播到总线上的其他各站点。站点中的网卡根据所收到的帧的目的MAC地址与自己的MAC地址是否匹配，来决定是否接受或丢弃帧。这样就在具有广播特性的总线上实现了一对一的通信。

    <img src="assets/image-20240701212455975.png" alt="image-20240701212455975" style="zoom:33%;" />

  - 当某个站点在总线上发送帧时，总线资源就会被该站点独占。此时如果总线上的其他站点也要在总线上发送帧，就会产生信号碰撞。

    <img src="assets/image-20240701212552316.png" alt="image-20240701212552316" style="zoom:33%;" />

  - 共享总线以太网的一个重要问题是：如何协调总线上的各站点争用总线。为了解决该问题，以太网使用了一种专用协议CSMA/CD，它是载波监听多址接入/碰撞检测的英文缩写词。

  - CSMA/CD协议的要点如下：

    - 多址接入：多个站点连接在一条总线上，它们竞争使用总线。

    - 载波监听：每一个站点在发送帧之前，先要检测一下总线上是否有其他站点在发送帧。若检测到总线空闲96比特时间，则发送帧；若检测到总线“忙”，则继续监测并等待总线转为空闲96比特时间后发送帧。因此可将载波监听比喻为“先听后说”。

    - 碰撞检测：每一个正在发送帧的站点必须“边发送帧边检测碰撞”。一旦发现总线上出现碰撞，就立即停止发送，退避一段随机时间后再次从载波监听开始进行发送。因此，可将碰撞检测比喻为“边说边听，一旦冲突，立即停说，等待时机，重新再说”。

      - 我们可能会有这样的疑问：既然站点在发送帧之前对总线进行了载波监听，检测到总线空闲后才进行发送，那么为什么在发送帧的过程中还要边发送帧边检测碰撞呢？

      - 这是因为站点检测到总线空闲时，总线并不一定是空闲的。如下图所示，主机B检测到总线空闲96比特时间后在总线上发送帧，稍后主机C也有帧要发送，主机C进行载波监听，检测到总线空闲，但此时总线并不空闲，只是主机B发送的信号还未传播到主机C。

        <img src="assets/image-20240701215438122.png" alt="image-20240701215438122" style="zoom:33%;" />

      - 综上所述，使用CSMA/CD协议的共享总线以太网上的各站点，只是尽量避免碰撞并在出现碰撞时做出退避后重发的处理，但不能完全避免碰撞。

- 争用期

  <img src="assets/image-20240701221423999.png" alt="image-20240701221423999" style="zoom:33%;" />

  - 从图中可以看出，最先发送帧的主机A，在开始发送帧后最多经过2τ时长（即δ→0）就可检测出所发送的帧是否遭遇了碰撞。
  - 因此，共享总线以太网的端到端往返时间2τ被称为争用期或碰撞窗口。
  - 共享总线以太网上的某个站点在开始发送帧后经过争用期2τ这段时间还没有检测到碰撞，就可以肯定这次发送不会产生碰撞。

- 退避算法

  - 共享总线以太网中正在发送帧的站点一边发送帧一边检测碰撞，当检测到碰撞时就立即停止发送，退避一段随机时间后再重新发送。那么，这段随机时间应该如何选择呢？

    <img src="assets/image-20240701223501758.png" alt="image-20240701223501758" style="zoom:33%;" />

  - 如果连续多次发生碰撞，就表明可能有较多的站点参与竞争信道。但使用上述退避算法可使重传需要推迟的平均时间随重传次数而增大（即动态退避），因而减小产生碰撞的概率。
  - 当重传达16 次仍不能成功时，就表明同时打算发送帧的站点太多，以至于连续产生碰撞，此时应放弃重传并向高层报告。

### 3.3.6 使用集线器的共享式以太网

- 使用同轴电缆共享总线以太网

  - 早期的传统以太网是使用粗同轴电缆的共享总线以太网，后来发展到使用价格相对便宜的细同轴电缆。

  - 当初认为这种连接方法既简单又可靠，因为在那个时代普遍认为有源器件不可靠，而无源的电缆线才是最可靠的。然而，实践证明这种使用无源电缆线和大量机械接口的总线型以太网并不像人们想象的那么可靠。

    <img src="assets/image-20240702155422100.png" alt="image-20240702155422100" style="zoom:33%;" />

  - 缺陷：若总线上的某个机械连接点接触不良或断开，则整个网络通信就不稳定或彻底断网。

- 使用集线器的共享式以太网

  - 在使用细同轴电缆的共享总线以太网之后，以太网发展出来了一种使用大规模集成电路来替代总线、并且可靠性非常高的设备，叫作集线器（Hub）。

  - 站点连接到集线器的传输媒体也转而使用更便宜、更灵活的双绞线电缆。

    <img src="assets/image-20240702161452173.png" alt="image-20240702161452173" style="zoom:33%;" />

  - 集线器的一些主要特点如下：
    - 使用集线器的以太网虽然物理拓扑是星型的，但在逻辑上仍然是一个总线网。总线上的各站点共享总线资源，使用的还是CSMA/CD协议。
    - 集线器只工作在物理层，它的每个接口仅简单地转发比特，并不进行碰撞检测。碰撞检测的任务由各站点中的网卡负责。
    - 集线器一般都有少量的容错能力和网络管理功能。例如，若网络中某个站点的网卡出现了故障而不停地发送帧，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网能正常工作。
